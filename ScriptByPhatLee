-- Auto click Gift_Notification Accept with pet filter rules
local player = game.Players.LocalPlayer
local playerGui = player:WaitForChild("PlayerGui")

-- Hàm kiểm tra pet có đạt yêu cầu không
local function shouldAcceptPet(petName, kg, age)
    local lowerName = string.lower(petName)

    for _, rule in ipairs(petRules) do
        local keywords = rule.keyword
        if type(keywords) ~= "table" then
            keywords = {keywords} -- nếu là string thì đưa vào table
        end

        for _, name in ipairs(keywords) do
            if string.find(lowerName, string.lower(name)) then
                -- Nếu pet không có age (nil) thì bỏ qua điều kiện maxAge
                local passAge = (not rule.maxAge or not age or age < rule.maxAge)
                if (not rule.minKg or kg >= rule.minKg) and passAge then
                    return true
                end
            end
        end
    end
    return false
end

-- Chạy liên tục mỗi 0.1s
while task.wait(0.1) do
    local giftUI = playerGui:FindFirstChild("Gift_Notification", true)
    if giftUI then
        local petLabel = giftUI:FindFirstChildWhichIsA("TextLabel", true)
        if petLabel and petLabel.Text then
            -- Thử bắt cả trường hợp có hoặc không có age
            local petName, kgStr, ageStr = string.match(petLabel.Text, "^(.-) %[(.-) KG%] %[Age (.-)%]$")
            if not petName then
                -- Nếu không có age thì chỉ lấy tên + kg
                petName, kgStr = string.match(petLabel.Text, "^(.-) %[(.-) KG%]$")
            end

            local kg = tonumber(kgStr)
            local age = tonumber(ageStr) -- nếu không có ageStr thì sẽ là nil

            if petName and kg and shouldAcceptPet(petName, kg, age) then
                local acceptBtn = giftUI:FindFirstChild("Accept", true)
                if acceptBtn and acceptBtn.Visible and acceptBtn.Active then
                    firesignal(acceptBtn.MouseButton1Click)
                    print(string.format("[AutoAccept] Accepted: %s [%.2f KG] %s", petName, kg, age and ("[Age " .. age .. "]") or "[No Age]"))
                end
            end
        end
    end
end
